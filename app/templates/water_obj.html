{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
<div class="row">
    <div id="map" style="width: 100%; height: 700px; margin-top:80px; overflow:hidden"></div>
</div>

<div class="row">
<nav style="margin-top:30px;">
  <div class="nav nav-tabs" id="nav-tab" role="tablist">
    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">
        Спутниковые данные
    </a>
    <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">
        Экспериментальные данные</a>
    <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">
        АПИК</a>
  </div>
</nav>
<div class="tab-content" id="nav-tabContent" style="width:100%">
  <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
      <div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th scope="col"># id</th>
        <th scope="col"></th>
        <th scope="col">Слой</th>
        <th scope="col">Параметр</th>
        <th scope="col">Формат</th>
        <th scope="col">Дата</th>
      </tr>
    </thead>
    <tbody>
  {% for layer in layers %}
    <tr>
        <th scope="row">{{ layer.id }}</th>
        <td>
          <input class="layer_control" name="layer_control" type="checkbox"
                 id="{{ layer.id }}"
                 value="{{ layer.title }}"
                 data-path="{{ layer.file }}"
                 data-typemap="{{ layer.type }}"
          >
        </td>
        <td>{{ layer.title }}</td>
        <td>{{ layer.param }}</td>
        <td><a href="/rasters/{{ layer.file }}">{{ layer.type }}</a></td>
        <td>{{ layer.date }}</td>

      </tr>

    {% endfor %}

    </tbody>
  </table>
</div>
  </div>
  <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
        Нет данных
  </div>
  <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
        Нет данных
  </div>
</div>


</div>

<script type="text/javascript">
    var mymap = L.map('map').setView([{{water_obj.lat}}, {{water_obj.long}}], 8);

	L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 18,

	}).addTo(mymap);

	var esri = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
		maxZoom: 18,
		name: "Esri.WorldImagery",

	});

	var layers = {};

	var layerGroup = L.layerGroup().addTo(mymap)

	function addLayerToMap(layerId, format, color) {

	    var url = '/cgi-bin/mapserv?map={{ project_path }}/static/maps/'+format+'.map&ctype={{ project_path }}/rasters/'+layerId + '&color='+ color;

	    var layer = L.tileLayer.wms(url, {
		    maxZoom: 18,
            format: 'image/png',
            transparent: true,
            layers: 'NDVI',
            crs: L.CRS.EPSG4326,
            version: '1.1.1',
	    });

	    return layer;

    }
</script>
<script type="text/javascript">
{% for layer in layers %}
    color = Math.floor(Math.random() * 200) ;
    layers["{{ layer.id }}"] = addLayerToMap($('#{{ layer.id }}').data("path"), $('#{{ layer.id }}').data("typemap"), color);
{% endfor %}

    $(".layer_control").change(function() {
                   layerGroup.addLayer(layers[$(this).attr('id')]);
                   var ischecked= $(this).is(':checked');
                   if(!ischecked) {
                        var x_id = L.stamp(layers[$(this).attr('id')]);
                        var layerObj = layers[$(this).attr('id')];
                        layerGroup.removeLayer(x_id);

                   }
     });
</script>
{% endblock %}


